<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CS2 Gambling</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'DIN 2014', 'DIN Bold', 'DIN Next LT Pro Bold', 'DIN', Arial, sans-serif;
            font-weight: 700;
            background: linear-gradient(180deg, #2a2520 0%, #1a1612 100%);
            color: #fff;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                repeating-linear-gradient(90deg, transparent, transparent 2px, rgba(255,255,255,0.02) 2px, rgba(255,255,255,0.02) 4px),
                repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(255,255,255,0.02) 2px, rgba(255,255,255,0.02) 4px);
            opacity: 0.3;
            pointer-events: none;
        }

        .top-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 30px;
            background: transparent;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .top-nav-left {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .top-nav-right {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .nav-icon-btn {
            width: 40px;
            height: 40px;
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nav-icon-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.4);
            color: #fff;
        }

        .profile-btn:hover {
            border-color: #5cb3e0;
            color: #5cb3e0;
        }

        .main-nav {
            display: flex;
            justify-content: center;
            gap: 80px;
            padding: 20px 0;
            background: transparent;
            position: relative;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .main-nav-item {
            font-size: 16px;
            font-weight: 700;
            font-family: 'DIN 2014', 'DIN Bold', 'DIN Next LT Pro Bold', 'DIN', Arial, sans-serif;
            letter-spacing: 2px;
            cursor: pointer;
            padding: 10px 0px;
            transition: all 0.2s;
            text-transform: uppercase;
            position: relative;
        }

        .main-nav-item::after {
            content: '';
            position: absolute;
            bottom: -20px;
            left: 0;
            right: 0;
            height: 2px;
            background: #5cb3e0;
            opacity: 0;
        }

        .main-nav-item.active::after {
            opacity: 1;
        }

        .main-nav-item.active {
            color: #5cb3e0;
        }

        .main-nav-item:hover:not(.active) {
            color: rgba(255, 255, 255, 0.8);
        }

        .sub-nav {
            display: none;
            gap: 5px;
            padding: 20px 40px;
            background: transparent;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            justify-content: flex-end;
            align-items: center;
        }

        .sub-nav.active {
            display: flex;
        }

        .sub-nav-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .sort-wrapper {
            display: flex;
            align-items: center;
            gap: 15px;
            position: relative;
        }

        .sort-dropdown {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 12px 20px;
            border-radius: 4px;
            font-size: 14px;
            color: #fff;
            cursor: pointer;
            min-width: 200px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            position: relative;
            transition: all 0.2s;
        }

        .sort-dropdown:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.4);
        }

        .sort-left {
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
        }

        .sort-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sort-icon svg {
            width: 100%;
            height: 100%;
        }

        .dropdown-arrow {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .sort-menu {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 5px;
            background: rgba(20, 18, 15, 0.98);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            min-width: 200px;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
        }

        .sort-menu.active {
            display: block;
        }

        .sort-option {
            padding: 12px 16px;
            font-size: 13px;
            color: rgba(255, 255, 255, 0.8);
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .sort-option:last-child {
            border-bottom: none;
        }

        .sort-option:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        .sort-option.active {
            color: #5cb3e0;
            background: rgba(92, 179, 224, 0.1);
        }

        .inventory-container {
            padding: 30px 40px;
            max-width: 1920px;
            margin: 0 auto;
        }

        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 15px;
        }

        .item-card {
            aspect-ratio: 1;
            background: linear-gradient(180deg, rgba(60, 55, 50, 0.4) 0%, rgba(40, 35, 30, 0.6) 50%, rgba(20, 18, 15, 0.8) 100%);
            border: 1px solid rgba(0, 0, 0, 0.5);
            border-radius: 0;
            padding: 12px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: visible;
            margin-bottom: 48px;
        }

        .item-card.consumer-grade { border-bottom: 4.5px solid #aaaaaa; }
        .item-card.industrial-grade { border-bottom: 4.5px solid #5e98d9; }
        .item-card.mil-spec { border-bottom: 4.5px solid #4b69ff; }
        .item-card.restricted { border-bottom: 4.5px solid #8847ff; }
        .item-card.classified { border-bottom: 4.5px solid #d32ce6; }
        .item-card.covert { border-bottom: 4.5px solid #eb4b4b; }
        .item-card.extraordinary { border-bottom: 4.5px solid #e4ae39; }

        .item-image-container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
        }

        .item-image-container.case-item {
            padding: 2px;
        }

        .item-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.5));
        }

        .item-info {
            position: absolute;
            top: calc(100% + 10px);
            left: 0;
            right: 0;
            text-align: left;
        }

        .item-name {
            font-size: 12px;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.9);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            padding: 0 5px;
            line-height: 1.3;
        }

        .item-skin {
            font-size: 12px;
            font-weight: 400;
            color: rgba(255, 255, 255, 0.5);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            padding: 0 5px;
            line-height: 1.3;
        }

        .item-type {
            display: none;
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 1000;
            animation: fadeIn 0.2s ease;
        }

        .modal-overlay.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            width: 90%;
            max-width: 1400px;
            height: 85vh;
            background: linear-gradient(180deg, rgba(42, 37, 32, 0.95) 0%, rgba(26, 22, 18, 0.95) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            padding: 30px 40px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }

        .modal-weapon-rarity {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.6);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 8px;
        }

        .modal-weapon-name {
            font-size: 32px;
            font-weight: 700;
            color: #fff;
            letter-spacing: 1px;
        }

        .rarity-bar {
            width: 200px;
            height: 4.5px;
            margin: 15px auto 0;
            border-radius: 2px;
        }

        .rarity-bar.consumer-grade { background: #aaaaaa; }
        .rarity-bar.industrial-grade { background: #5e98d9; }
        .rarity-bar.mil-spec { background: #4b69ff; }
        .rarity-bar.restricted { background: #8847ff; }
        .rarity-bar.classified { background: #d32ce6; }
        .rarity-bar.covert { background: #eb4b4b; }
        .rarity-bar.extraordinary { background: #e4ae39; }

        .modal-body {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            background: radial-gradient(ellipse at center, rgba(255, 255, 255, 0.03) 0%, transparent 60%);
        }

        .weapon-display {
            font-size: 200px;
            animation: float 4s ease-in-out infinite;
            filter: drop-shadow(0 20px 40px rgba(0, 0, 0, 0.8));
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(-10deg); }
            50% { transform: translateY(-15px) rotate(-8deg); }
        }

        .modal-footer {
            padding: 30px 40px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .modal-close-btn {
            padding: 14px 40px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #fff;
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .modal-close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .modal-unlock-btn {
            padding: 14px 40px;
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid rgba(76, 175, 80, 0.5);
            color: #4caf50;
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            transition: all 0.2s;
            display: none;
        }

        .modal-unlock-btn:hover {
            background: rgba(76, 175, 80, 0.3);
            border-color: rgba(76, 175, 80, 0.7);
        }

        .modal-delete-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 40px;
            height: 40px;
            background: transparent;
            border: none;
            color: #eb4b4b;
            cursor: pointer;
            transition: all 0.2s;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.5));
        }

        .modal-delete-btn:hover {
            transform: scale(1.1);
        }

        .confirm-dialog {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(180deg, rgba(42, 37, 32, 0.98) 0%, rgba(26, 22, 18, 0.98) 100%);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 30px 40px;
            z-index: 2000;
            min-width: 400px;
            text-align: center;
        }

        .confirm-dialog.active {
            display: block;
        }

        .confirm-dialog-text {
            font-size: 18px;
            color: #fff;
            margin-bottom: 25px;
        }

        .confirm-dialog-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .confirm-yes-btn {
            padding: 12px 30px;
            background: rgba(235, 75, 75, 0.2);
            border: 1px solid rgba(235, 75, 75, 0.5);
            color: #eb4b4b;
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.2s;
        }

        .confirm-yes-btn:hover { background: rgba(235, 75, 75, 0.3); }

        .confirm-no-btn {
            padding: 12px 30px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #fff;
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.2s;
        }

        .confirm-no-btn:hover { background: rgba(255, 255, 255, 0.2); }

        .tab-content {
            display: none;
            min-height: calc(100vh - 200px);
        }

        .tab-content.active {
            display: block;
        }

        .version-text {
            font-size: 120px;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.15);
            text-align: center;
            padding-top: 200px;
            letter-spacing: 10px;
        }

        .coming-soon {
            font-size: 32px;
            color: rgba(255, 255, 255, 0.4);
            text-align: center;
            padding-top: 200px;
            letter-spacing: 4px;
            text-transform: uppercase;
        }

        .store-container {
            padding: 30px 40px;
            max-width: 1920px;
            margin: 0 auto;
        }

        .store-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, 180px);
            gap: 12px;
            justify-content: center;
        }

        .case-card {
            width: 180px;
            height: 290px;
            background: rgba(30, 30, 30, 0.95);
            border: none;
            padding: 0;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
            border-radius: 4px;
        }

        .case-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.7);
        }

        .case-image-container {
            height: 190px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .case-card .case-image-container {
            background: radial-gradient(ellipse at center, var(--glow-color, rgba(220, 140, 60, 0.35)) 0%, rgba(30, 30, 30, 0.95) 70%);
        }

        .case-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.5));
        }

        .case-info {
            background: rgba(35, 35, 35, 0.98);
            padding: 10px 12px;
            text-align: left;
            height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .case-top {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .case-name {
            font-size: 13px;
            font-weight: 700;
            color: #fff;
            font-family: 'DIN 2014', 'DIN Bold', 'DIN Next LT Pro Bold', 'DIN', Arial, sans-serif;
            line-height: 1.3;
        }

        .case-price {
            font-size: 16px;
            font-weight: 700;
            color: #5cb3e0;
            font-family: 'DIN 2014', 'DIN Bold', 'DIN Next LT Pro Bold', 'DIN', Arial, sans-serif;
        }

        .case-market-btn {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 11px;
            color: rgba(255, 255, 255, 0.6);
            font-family: 'DIN 2014', 'DIN Bold', 'DIN Next LT Pro Bold', 'DIN', Arial, sans-serif;
            font-weight: 700;
            transition: color 0.2s;
            cursor: pointer;
        }

        .case-market-btn:hover { color: #fff; }

        .info-icon {
            width: 14px;
            height: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-radius: 50%;
            font-size: 8px;
            font-weight: 700;
            font-style: italic;
            font-family: Georgia, serif;
            padding-bottom: 1px;
        }

        /* ================================
           CASE OPENING OVERLAY
        ================================ */
        .case-opening-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.98);
            z-index: 3000;
            animation: fadeIn 0.3s ease;
        }

        .case-opening-overlay.active {
            display: block;
        }

        .case-opening-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .roll-viewport {
            width: 100%;
            height: 220px;
            position: relative;
            overflow: hidden;
            margin: 40px 0;
        }

        /* Left and right fade edges */
        .roll-viewport::before,
        .roll-viewport::after {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            width: 200px;
            z-index: 10;
            pointer-events: none;
        }

        .roll-viewport::before {
            left: 0;
            background: linear-gradient(to right, rgba(0,0,0,0.98), transparent);
        }

        .roll-viewport::after {
            right: 0;
            background: linear-gradient(to left, rgba(0,0,0,0.98), transparent);
        }

        .roll-selector {
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 3px;
            background: linear-gradient(180deg, transparent 0%, #4caf50 20%, #4caf50 80%, transparent 100%);
            transform: translateX(-50%);
            z-index: 100;
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.8);
        }

        /* Triangle indicators */
        .roll-selector::before,
        .roll-selector::after {
            content: '';
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
        }

        .roll-selector::before {
            top: 0;
            border-top: 12px solid #4caf50;
        }

        .roll-selector::after {
            bottom: 0;
            border-bottom: 12px solid #4caf50;
        }

        .roll-items {
            display: flex;
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            left: 0;
            gap: 8px;
            will-change: transform;
        }

        .roll-item {
            width: 190px;
            height: 180px;
            background: linear-gradient(180deg, rgba(60, 55, 50, 0.6) 0%, rgba(40, 35, 30, 0.8) 50%, rgba(20, 18, 15, 0.95) 100%);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 4px;
            padding: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
            position: relative;
        }

        .roll-item::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            border-radius: 0 0 4px 4px;
        }

        .roll-item.consumer-grade::after { background: #aaaaaa; }
        .roll-item.industrial-grade::after { background: #5e98d9; }
        .roll-item.mil-spec::after { background: #4b69ff; }
        .roll-item.restricted::after { background: #8847ff; }
        .roll-item.classified::after { background: #d32ce6; }
        .roll-item.covert::after { background: #eb4b4b; }
        .roll-item.extraordinary::after { background: #e4ae39; }

        .roll-item-image {
            width: 100%;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .roll-item-image img {
            max-width: 90%;
            max-height: 90px;
            object-fit: contain;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.5));
        }

        .roll-item-name {
            font-size: 11px;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.85);
            text-align: center;
            line-height: 1.3;
            margin-top: 8px;
            padding: 0 4px;
        }

        .opening-skip-btn {
            position: absolute;
            bottom: 60px;
            padding: 12px 30px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #fff;
            font-size: 13px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            cursor: pointer;
            transition: all 0.2s;
            opacity: 0;
            animation: fadeInDelay 0.3s ease 1.5s forwards;
        }

        @keyframes fadeInDelay {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .opening-skip-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
        }

        /* ================================
           WIN REVEAL OVERLAY
        ================================ */
        .win-reveal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 4000;
            animation: fadeIn 0.3s ease;
        }

        .win-reveal-overlay.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .win-reveal-content {
            text-align: center;
            animation: scaleIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes scaleIn {
            from { opacity: 0; transform: scale(0.5); }
            to { opacity: 1; transform: scale(1); }
        }

        .win-reveal-rarity {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.6);
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 15px;
        }

        .win-reveal-name {
            font-size: 48px;
            font-weight: 700;
            color: #fff;
            letter-spacing: 2px;
            margin-bottom: 25px;
        }

        .win-reveal-image {
            width: 500px;
            height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 40px;
            filter: drop-shadow(0 20px 60px rgba(0, 0, 0, 0.8));
        }

        .win-reveal-image img {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
        }

        .win-reveal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .win-reveal-btn {
            padding: 14px 40px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #fff;
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .win-reveal-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .win-reveal-btn.primary {
            background: rgba(76, 175, 80, 0.2);
            border-color: rgba(76, 175, 80, 0.5);
            color: #4caf50;
        }

        .win-reveal-btn.primary:hover {
            background: rgba(76, 175, 80, 0.3);
            border-color: rgba(76, 175, 80, 0.7);
        }

        /* Case Details Modal */
        .case-details-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 3000;
            animation: fadeIn 0.3s ease;
            overflow-y: auto;
        }

        .case-details-overlay.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
        }

        .case-details-content {
            width: 90%;
            max-width: 1200px;
            background: linear-gradient(180deg, rgba(42, 37, 32, 0.95) 0%, rgba(26, 22, 18, 0.95) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            display: flex;
            flex-direction: column;
            max-height: 90vh;
        }

        .case-details-header {
            padding: 30px 40px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 30px;
        }

        .case-details-image {
            width: 150px;
            height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: radial-gradient(ellipse at center, rgba(220, 140, 60, 0.35) 0%, transparent 70%);
            border-radius: 4px;
        }

        .case-details-image img {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
            filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.5));
        }

        .case-details-info { flex: 1; }

        .case-details-name {
            font-size: 36px;
            font-weight: 700;
            color: #fff;
            margin-bottom: 10px;
        }

        .case-details-price {
            font-size: 28px;
            font-weight: 700;
            color: #5cb3e0;
            margin-bottom: 15px;
        }

        .case-details-buy-btn {
            padding: 12px 30px;
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid rgba(76, 175, 80, 0.5);
            color: #4caf50;
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-block;
        }

        .case-details-buy-btn:hover {
            background: rgba(76, 175, 80, 0.3);
            border-color: rgba(76, 175, 80, 0.7);
        }

        .case-details-body {
            flex: 1;
            overflow-y: auto;
            padding: 30px 40px;
        }

        .case-details-section-title {
            font-size: 20px;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.9);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .case-details-items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .case-details-item {
            background: linear-gradient(180deg, rgba(60, 55, 50, 0.4) 0%, rgba(40, 35, 30, 0.6) 50%, rgba(20, 18, 15, 0.8) 100%);
            border: 1px solid rgba(0, 0, 0, 0.5);
            border-radius: 4px;
            padding: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            transition: all 0.2s;
        }

        .case-details-item:hover {
            transform: translateY(-3px);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .case-details-item::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
        }

        .case-details-item.mil-spec::after { background: #4b69ff; }
        .case-details-item.restricted::after { background: #8847ff; }
        .case-details-item.classified::after { background: #d32ce6; }
        .case-details-item.covert::after { background: #eb4b4b; }
        .case-details-item.extraordinary::after { background: #e4ae39; }

        .case-details-item-image {
            width: 100%;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
        }

        .case-details-item-image img {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.5));
        }

        .case-details-item-name {
            font-size: 11px;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.9);
            text-align: center;
            line-height: 1.2;
        }

        .case-details-footer {
            padding: 20px 40px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: center;
        }

        .case-details-close-btn {
            padding: 14px 40px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #fff;
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .case-details-close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .rarity-group { margin-bottom: 25px; }

        .rarity-group-header {
            font-size: 14px;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.7);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: 12px;
            padding-left: 5px;
        }

        .rarity-group-header.mil-spec { color: #4b69ff; }
        .rarity-group-header.restricted { color: #8847ff; }
        .rarity-group-header.classified { color: #d32ce6; }
        .rarity-group-header.covert { color: #eb4b4b; }
        .rarity-group-header.extraordinary { color: #e4ae39; }

        @media (max-width: 1200px) {
            .inventory-grid { grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); }
        }

        @media (max-width: 768px) {
            .main-nav { gap: 20px; }
            .inventory-grid { grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); }
        }
    </style>
</head>
<body>

    <div class="top-nav">
        <div class="top-nav-left">
            <button class="nav-icon-btn" id="powerBtn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                    <path d="M12 2v10M16.24 7.76a6 6 0 1 1-8.48 0" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
            <button class="nav-icon-btn" id="settingsBtn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                    <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
                    <path d="M12 1v3m0 16v3M4.22 4.22l2.12 2.12m11.32 11.32l2.12 2.12M1 12h3m16 0h3M4.22 19.78l2.12-2.12m11.32-11.32l2.12-2.12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
            </button>
        </div>
        <div class="top-nav-right">
            <button class="nav-icon-btn profile-btn" id="profileBtn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                    <circle cx="12" cy="8" r="4" stroke="currentColor" stroke-width="2"/>
                    <path d="M6 21v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
            </button>
        </div>
    </div>

    <div class="main-nav">
        <div class="main-nav-item active" data-nav="inventory">INVENTORY</div>
        <div class="main-nav-item" data-nav="store">STORE</div>
        <div class="main-nav-item" data-nav="news">NEWS</div>
        <div class="main-nav-item" data-nav="info">INFO</div>
    </div>

    <div class="sub-nav active" id="subNav">
        <div class="sub-nav-right">
            <div class="sort-wrapper">
                <div class="sort-icon">
                    <svg width="24" height="24" viewBox="0 0 20 20" fill="none">
                        <rect x="4" y="2" width="2.5" height="16" fill="currentColor"/>
                        <rect x="7.5" y="2" width="9.5" height="2.5" fill="currentColor"/>
                        <rect x="7.5" y="7" width="7" height="2.5" fill="currentColor"/>
                        <rect x="7.5" y="12" width="4.5" height="2.5" fill="currentColor"/>
                    </svg>
                </div>
                <div class="sort-dropdown" id="sortDropdown">
                    <span id="sortLabel">Newest</span>
                    <div class="dropdown-arrow">
                        <svg width="20" height="20" viewBox="0 0 16 16" fill="none">
                            <path d="M4 6L8 10L12 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <div class="sort-menu" id="sortMenu">
                        <div class="sort-option active" data-sort="newest">Newest</div>
                        <div class="sort-option" data-sort="rarity-down">Rarity (High to Low)</div>
                        <div class="sort-option" data-sort="rarity-up">Rarity (Low to High)</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Inventory Tab -->
    <div class="tab-content active" id="inventoryTab">
        <div class="inventory-container">
            <div class="inventory-grid" id="inventoryGrid"></div>
        </div>
    </div>

    <!-- Store Tab -->
    <div class="tab-content" id="storeTab">
        <div class="store-container">
            <div class="store-grid">
                <div class="case-card" data-case-id="snakebite" style="--glow-color: rgba(220, 140, 60, 0.35);">
                    <div class="case-image-container">
                        <img src="images/snakebite.webp" alt="Snakebite Case" class="case-image">
                    </div>
                    <div class="case-info">
                        <div class="case-top">
                            <div class="case-name">Snakebite Case</div>
                            <div class="case-price">$2.50</div>
                        </div>
                        <div class="case-market-btn">
                            <span>View On Market</span>
                            <div class="info-icon">i</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- News Tab -->
    <div class="tab-content" id="newsTab">
        <div class="coming-soon">Coming Soon</div>
    </div>

    <!-- Info Tab -->
    <div class="tab-content" id="infoTab">
        <div class="version-text">v1.0</div>
    </div>

    <!-- Inspection Modal -->
    <div class="modal-overlay" id="inspectModal">
        <div class="modal-content">
            <button class="modal-delete-btn" id="deleteModal" style="display: none;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <path d="M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2m3 0v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6h14z" stroke="#eb4b4b" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M10 11v6M14 11v6" stroke="#eb4b4b" stroke-width="2" stroke-linecap="round"/>
                </svg>
            </button>
            <div class="modal-header">
                <div class="modal-weapon-rarity" id="modalRarity">CONSUMER GRADE</div>
                <div class="modal-weapon-name" id="modalWeaponName">Default Knife</div>
                <div class="rarity-bar consumer-grade" id="modalRarityBar"></div>
            </div>
            <div class="modal-body">
                <div class="weapon-display" id="modalWeaponEmoji">ðŸ”ª</div>
            </div>
            <div class="modal-footer">
                <button class="modal-close-btn" id="closeModal">CLOSE</button>
                <button class="modal-unlock-btn" id="unlockCaseBtn">UNLOCK CASE</button>
            </div>
        </div>
    </div>

    <!-- Confirmation Dialog -->
    <div class="confirm-dialog" id="confirmDialog">
        <div class="confirm-dialog-text">Are you sure you want to delete this item?</div>
        <div class="confirm-dialog-buttons">
            <button class="confirm-yes-btn" id="confirmYes">YES</button>
            <button class="confirm-no-btn" id="confirmNo">NO</button>
        </div>
    </div>

    <!-- Case Opening Overlay -->
    <div class="case-opening-overlay" id="caseOpeningOverlay">
        <div class="case-opening-container">
            <div class="roll-viewport">
                <div class="roll-selector"></div>
                <div class="roll-items" id="rollItems"></div>
            </div>
            <button class="opening-skip-btn" id="skipOpeningBtn">SKIP</button>
        </div>
    </div>

    <!-- Win Reveal Overlay -->
    <div class="win-reveal-overlay" id="winRevealOverlay">
        <div class="win-reveal-content">
            <div class="win-reveal-rarity" id="winRarity">COVERT</div>
            <div class="win-reveal-name" id="winName">AK-47 | Redline</div>
            <div class="win-reveal-image" id="winImage">
                <img src="" alt="">
            </div>
            <div class="win-reveal-buttons">
                <button class="win-reveal-btn" id="winCloseBtn">CLOSE</button>
                <button class="win-reveal-btn primary" id="winOpenAnotherBtn">OPEN ANOTHER</button>
            </div>
        </div>
    </div>

    <!-- Case Details Modal -->
    <div class="case-details-overlay" id="caseDetailsOverlay">
        <div class="case-details-content">
            <div class="case-details-header">
                <div class="case-details-image" id="caseDetailsImage">
                    <img src="" alt="">
                </div>
                <div class="case-details-info">
                    <div class="case-details-name" id="caseDetailsName">Snakebite Case</div>
                    <div class="case-details-price" id="caseDetailsPrice">$2.50</div>
                    <button class="case-details-buy-btn" id="caseDetailsBuyBtn">BUY CASE</button>
                </div>
            </div>
            <div class="case-details-body">
                <div class="case-details-section-title">CASE CONTENTS</div>
                <div id="caseDetailsItemsContainer"></div>
            </div>
            <div class="case-details-footer">
                <button class="case-details-close-btn" id="caseDetailsCloseBtn">CLOSE</button>
            </div>
        </div>
    </div>

    <script>
        // ========================================
        // RESET ALL USER DATA
        const availableCases = [
            { id: 'snakebite', name: 'Snakebite Case', imageName: 'snakebite.webp' }
        ];

        let userCases = JSON.parse(localStorage.getItem('userCases')) || [];

        const defaultInventory = [
            { name: 'Glock-18', type: 'Pistol', rarity: 'consumer-grade', imageName: 'glock-18.webp' },
            { name: 'P2000', type: 'Pistol', rarity: 'consumer-grade', imageName: 'p2000.webp' },
            { name: 'USP-S', type: 'Pistol', rarity: 'consumer-grade', imageName: 'usp-s.webp' },
            { name: 'P250', type: 'Pistol', rarity: 'consumer-grade', imageName: 'p250.webp' },
            { name: 'Five-SeveN', type: 'Pistol', rarity: 'consumer-grade', imageName: 'five-seven.webp' },
            { name: 'Tec-9', type: 'Pistol', rarity: 'consumer-grade', imageName: 'tec-9.webp' },
            { name: 'CZ75-Auto', type: 'Pistol', rarity: 'consumer-grade', imageName: 'cz75-auto.webp' },
            { name: 'Desert Eagle', type: 'Pistol', rarity: 'consumer-grade', imageName: 'desert-eagle.webp' },
            { name: 'Dual Berettas', type: 'Pistol', rarity: 'consumer-grade', imageName: 'dual-berettas.webp' },
            { name: 'R8 Revolver', type: 'Pistol', rarity: 'consumer-grade', imageName: 'r8-revolver.webp' },
            { name: 'MAC-10', type: 'SMG', rarity: 'consumer-grade', imageName: 'mac-10.webp' },
            { name: 'MP9', type: 'SMG', rarity: 'consumer-grade', imageName: 'mp9.webp' },
            { name: 'MP7', type: 'SMG', rarity: 'consumer-grade', imageName: 'mp7.webp' },
            { name: 'MP5-SD', type: 'SMG', rarity: 'consumer-grade', imageName: 'mp5-sd.webp' },
            { name: 'UMP-45', type: 'SMG', rarity: 'consumer-grade', imageName: 'ump-45.webp' },
            { name: 'P90', type: 'SMG', rarity: 'consumer-grade', imageName: 'p90.webp' },
            { name: 'PP-Bizon', type: 'SMG', rarity: 'consumer-grade', imageName: 'pp-bizon.webp' },
            { name: 'FAMAS', type: 'Rifle', rarity: 'consumer-grade', imageName: 'famas.webp' },
            { name: 'Galil AR', type: 'Rifle', rarity: 'consumer-grade', imageName: 'galil-ar.webp' },
            { name: 'AK-47', type: 'Rifle', rarity: 'consumer-grade', imageName: 'ak-47.webp' },
            { name: 'M4A4', type: 'Rifle', rarity: 'consumer-grade', imageName: 'm4a4.webp' },
            { name: 'M4A1-S', type: 'Rifle', rarity: 'consumer-grade', imageName: 'm4a1-s.webp' },
            { name: 'SG 553', type: 'Rifle', rarity: 'consumer-grade', imageName: 'sg-553.webp' },
            { name: 'AUG', type: 'Rifle', rarity: 'consumer-grade', imageName: 'aug.webp' },
            { name: 'SSG 08', type: 'Sniper Rifle', rarity: 'consumer-grade', imageName: 'ssg-08.webp' },
            { name: 'AWP', type: 'Sniper Rifle', rarity: 'consumer-grade', imageName: 'awp.webp' },
            { name: 'G3SG1', type: 'Sniper Rifle', rarity: 'consumer-grade', imageName: 'g3sg1.webp' },
            { name: 'SCAR-20', type: 'Sniper Rifle', rarity: 'consumer-grade', imageName: 'scar-20.webp' },
            { name: 'Nova', type: 'Shotgun', rarity: 'consumer-grade', imageName: 'nova.webp' },
            { name: 'XM1014', type: 'Shotgun', rarity: 'consumer-grade', imageName: 'xm1014.webp' },
            { name: 'Sawed-Off', type: 'Shotgun', rarity: 'consumer-grade', imageName: 'sawed-off.webp' },
            { name: 'MAG-7', type: 'Shotgun', rarity: 'consumer-grade', imageName: 'mag-7.webp' },
            { name: 'M249', type: 'Machine Gun', rarity: 'consumer-grade', imageName: 'm249.webp' },
            { name: 'Negev', type: 'Machine Gun', rarity: 'consumer-grade', imageName: 'negev.webp' },
            { name: 'Knife', type: 'Knife', rarity: 'consumer-grade', imageName: 'knifet.webp', brightness: 0.5 },
            { name: 'Knife', type: 'Knife', rarity: 'consumer-grade', imageName: 'knifect.webp', brightness: 0.5 },
            { name: 'Default T Gloves', type: 'Gloves', rarity: 'consumer-grade', imageName: 'glovest.webp', imageScale: 1.25, offsetX: 7.5, offsetY: 7.5, brightness: 0.5 },
            { name: 'Default CT Gloves', type: 'Gloves', rarity: 'consumer-grade', imageName: 'glovesct.webp', brightness: 0.5 },
        ];

        const inventoryGrid = document.getElementById('inventoryGrid');
        const sortLabel = document.getElementById('sortLabel');
        let currentSort = localStorage.getItem('sortPreference') || 'newest';
        let inventoryCards = [];

        const rarityOrder = {
            'extraordinary': 0, 'covert': 1, 'classified': 2,
            'restricted': 3, 'mil-spec': 4, 'industrial-grade': 5, 'consumer-grade': 6
        };

        // Weapon type order used as tiebreaker (priority 2) within the same rarity
        // Lower number = higher up
        const gunTypeOrder = {
            'Knife': 0, 'Gloves': 1, 'Sniper Rifle': 2,
            'Rifle': 3, 'Shotgun': 4, 'Machine Gun': 5, 'SMG': 6, 'Pistol': 7
        };

        function sortInventory(sortType) {
            currentSort = sortType;
            const sortedCards = [...inventoryCards].sort((a, b) => {
                const itemA = a.itemData;
                const itemB = b.itemData;

                if (sortType === 'newest') return itemA.originalIndex - itemB.originalIndex;

                if (sortType === 'rarity-down') {
                    // Cases always pinned to top
                    if (itemA.type === 'Case' && itemB.type !== 'Case') return -1;
                    if (itemB.type === 'Case' && itemA.type !== 'Case') return 1;

                    // Priority 1: rarity (lower rarityOrder number = higher rarity = higher up)
                    const rarityA = rarityOrder[itemA.rarity] ?? 99;
                    const rarityB = rarityOrder[itemB.rarity] ?? 99;
                    if (rarityA !== rarityB) return rarityA - rarityB;

                    // Priority 2: weapon type
                    const typeA = gunTypeOrder[itemA.type] ?? 99;
                    const typeB = gunTypeOrder[itemB.type] ?? 99;
                    if (typeA !== typeB) return typeA - typeB;

                    // Priority 3: alphabetical
                    return itemA.name.localeCompare(itemB.name);
                }

                if (sortType === 'rarity-up') {
                    // Cases always pinned to bottom
                    if (itemA.type === 'Case' && itemB.type !== 'Case') return 1;
                    if (itemB.type === 'Case' && itemA.type !== 'Case') return -1;

                    // Priority 1: rarity (higher rarityOrder number = lower rarity = higher up)
                    const rarityA = rarityOrder[itemA.rarity] ?? 99;
                    const rarityB = rarityOrder[itemB.rarity] ?? 99;
                    if (rarityA !== rarityB) return rarityB - rarityA;

                    // Priority 2: weapon type (reversed)
                    const typeA = gunTypeOrder[itemA.type] ?? 99;
                    const typeB = gunTypeOrder[itemB.type] ?? 99;
                    if (typeA !== typeB) return typeB - typeA;

                    // Priority 3: alphabetical
                    return itemA.name.localeCompare(itemB.name);
                }

                return 0;
            });
            inventoryGrid.innerHTML = '';
            sortedCards.forEach(card => inventoryGrid.appendChild(card));
        }
        function renderInventory() {
            inventoryGrid.innerHTML = '';
            inventoryCards = [];
            let index = 0;

            defaultInventory.forEach((item) => {
                const card = createInventoryCard(item, index, false);
                inventoryCards.push(card);
                inventoryGrid.appendChild(card);
                index++;
            });

            userCases.forEach((caseItem) => {
                const card = createInventoryCard(caseItem, index, true);
                inventoryCards.push(card);
                inventoryGrid.appendChild(card);
                index++;
            });

            let userWins = JSON.parse(localStorage.getItem('userWins')) || [];
            userWins.forEach((winItem) => {
                const card = createInventoryCard(winItem, index, false);
                inventoryCards.push(card);
                inventoryGrid.appendChild(card);
                index++;
            });
        }

        function createInventoryCard(item, index, isDeletable) {
            const card = document.createElement('div');
            card.className = `item-card ${item.rarity}`;

            const styles = [];
            if (item.imageScale || item.offsetX || item.offsetY) {
                const transforms = [];
                if (item.imageScale) transforms.push(`scale(${item.imageScale})`);
                if (item.offsetX || item.offsetY) transforms.push(`translate(${item.offsetX || 0}px, ${item.offsetY || 0}px)`);
                styles.push(`transform: ${transforms.join(' ')}`);
            }
            if (item.brightness) styles.push(`filter: brightness(${item.brightness})`);
            const imageStyle = styles.length > 0 ? `style="${styles.join('; ')};"` : '';

            const isCase = item.type === 'Case';
            const imagePath = getItemImagePath(item);

            // Split "Weapon | Skin Name" into two parts
            const nameParts = item.name.split(' | ');
            const weaponLabel = nameParts[0];
            const skinLabel = nameParts.length > 1 ? nameParts.slice(1).join(' | ') : '';

            card.innerHTML = `
                <div class="item-image-container${isCase ? ' case-item' : ''}">
                    <img src="${imagePath}" alt="${item.name}" class="item-image" ${imageStyle}>
                </div>
                <div class="item-info">
                    <div class="item-name">${weaponLabel}</div>
                    ${skinLabel ? `<div class="item-skin">${skinLabel}</div>` : ''}
                </div>
            `;

            card.addEventListener('click', () => openInspectModal(item, isDeletable));
            card.itemData = { ...item, originalIndex: index, isDeletable };
            return card;
        }

        renderInventory();

        if (currentSort !== 'newest') {
            sortInventory(currentSort);
            document.querySelectorAll('.sort-option').forEach(opt => {
                if (opt.dataset.sort === currentSort) {
                    opt.classList.add('active');
                    sortLabel.textContent = opt.textContent;
                } else {
                    opt.classList.remove('active');
                }
            });
        }

        const sortDropdown = document.getElementById('sortDropdown');
        const sortMenu = document.getElementById('sortMenu');

        sortDropdown.addEventListener('click', (e) => {
            e.stopPropagation();
            sortMenu.classList.toggle('active');
        });

        document.addEventListener('click', () => sortMenu.classList.remove('active'));

        document.querySelectorAll('.sort-option').forEach(option => {
            option.addEventListener('click', (e) => {
                e.stopPropagation();
                const sortType = option.dataset.sort;
                document.querySelectorAll('.sort-option').forEach(opt => opt.classList.remove('active'));
                option.classList.add('active');
                sortLabel.textContent = option.textContent;
                sortInventory(sortType);
                localStorage.setItem('sortPreference', sortType);
                sortMenu.classList.remove('active');
            });
        });

        // Modal functionality
        const modal = document.getElementById('inspectModal');
        const closeBtn = document.getElementById('closeModal');
        let currentModalItem = null;

        function openInspectModal(item, isDeletable = false) {
            currentModalItem = item;
            const weaponName = item.name;
            const rarityText = item.rarity === 'consumer-grade'
                ? 'STANDARD'
                : (item.rarity || 'special').toUpperCase().replace(/-/g, ' ');

            if (item.rarity === 'extraordinary') {
                document.getElementById('modalWeaponName').textContent = `â˜… ${weaponName} â˜…`;
                document.getElementById('modalRarity').textContent = `â˜… ${rarityText} â˜…`;
            } else if (item.rarity === 'covert') {
                document.getElementById('modalWeaponName').textContent = weaponName;
                document.getElementById('modalRarity').textContent = `â˜… ${rarityText} â˜…`;
            } else {
                document.getElementById('modalWeaponName').textContent = weaponName;
                document.getElementById('modalRarity').textContent = rarityText;
            }

            const modalDisplay = document.getElementById('modalWeaponEmoji');
            const modalStyles = [];
            const transforms = [];

            if (item.type === 'Knife' || item.type === 'Gloves') {
                transforms.push('scale(2)');
            } else if (item.imageScale) {
                transforms.push(`scale(${item.imageScale})`);
            }
            if (item.offsetX || item.offsetY) transforms.push(`translate(${item.offsetX || 0}px, ${item.offsetY || 0}px)`);
            if (transforms.length > 0) modalStyles.push(`transform: ${transforms.join(' ')}`);
            if (item.brightness) modalStyles.push(`filter: brightness(${item.brightness})`);

            const isCase = item.type === 'Case';
            const imagePath = getItemImagePath(item);
            const modalStyleStr = modalStyles.length > 0 ? modalStyles.join('; ') + ';' : '';
            const modalSize = isCase ? '90%' : '70%';
            modalDisplay.innerHTML = `<img src="${imagePath}" alt="${item.name}" style="max-width: ${modalSize}; max-height: ${modalSize}; object-fit: contain; display: block; margin: auto; ${modalStyleStr}">`;

            const rarityBar = document.getElementById('modalRarityBar');
            rarityBar.className = `rarity-bar ${item.rarity || 'extraordinary'}`;

            const deleteBtn = document.getElementById('deleteModal');
            deleteBtn.style.display = isDeletable ? 'flex' : 'none';

            const unlockBtn = document.getElementById('unlockCaseBtn');
            unlockBtn.style.display = (item.type === 'Case' && isDeletable) ? 'block' : 'none';

            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeInspectModal() {
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        closeBtn.addEventListener('click', closeInspectModal);
        modal.addEventListener('click', function(e) {
            if (e.target === modal) closeInspectModal();
        });
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && modal.classList.contains('active')) closeInspectModal();
        });

        function extractDominantColor(imgElement, callback) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();
            img.crossOrigin = 'Anonymous';
            img.src = imgElement.src;
            img.onload = function() {
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const data = imageData.data;
                let r = 0, g = 0, b = 0, count = 0;
                for (let i = 0; i < data.length; i += 4) {
                    if (data[i+3] > 50 && (data[i] + data[i+1] + data[i+2]) > 100) {
                        r += data[i]; g += data[i+1]; b += data[i+2]; count++;
                    }
                }
                if (count > 0) callback(`rgba(${Math.floor(r/count)}, ${Math.floor(g/count)}, ${Math.floor(b/count)}, 0.35)`);
                else callback('rgba(220, 140, 60, 0.35)');
            };
            img.onerror = () => callback('rgba(220, 140, 60, 0.35)');
        }

        document.querySelectorAll('.case-card').forEach(card => {
            const img = card.querySelector('.case-image');
            if (img) extractDominantColor(img, (color) => card.style.setProperty('--glow-color', color));
        });

        // Case details
        function showCaseDetails(caseId) {
            const caseData = availableCases.find(c => c.id === caseId);
            if (!caseData) return;

            document.getElementById('caseDetailsImage').innerHTML = `<img src="images/${caseData.imageName}" alt="${caseData.name}">`;
            document.getElementById('caseDetailsName').textContent = caseData.name;
            document.getElementById('caseDetailsPrice').textContent = '$2.50';

            const lootPool = caseLootPools[caseId] || caseLootPools['snakebite'];
            const itemsByRarity = { 'extraordinary': [], 'covert': [], 'classified': [], 'restricted': [], 'mil-spec': [] };

            lootPool.forEach(item => {
                if (!itemsByRarity[item.rarity].some(i => i.name === item.name)) {
                    itemsByRarity[item.rarity].push(item);
                }
            });

            const itemsContainer = document.getElementById('caseDetailsItemsContainer');
            itemsContainer.innerHTML = '';

            const rarityNames = {
                'extraordinary': 'â˜… EXTRAORDINARY (KNIVES & GLOVES) â˜…',
                'covert': 'COVERT', 'classified': 'CLASSIFIED',
                'restricted': 'RESTRICTED', 'mil-spec': 'MIL-SPEC'
            };

            Object.keys(itemsByRarity).forEach(rarity => {
                const items = itemsByRarity[rarity];
                if (items.length === 0) return;

                const groupDiv = document.createElement('div');
                groupDiv.className = 'rarity-group';
                const headerDiv = document.createElement('div');
                headerDiv.className = `rarity-group-header ${rarity}`;
                headerDiv.textContent = rarityNames[rarity];
                groupDiv.appendChild(headerDiv);

                const gridDiv = document.createElement('div');
                gridDiv.className = 'case-details-items-grid';

                items.forEach(item => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = `case-details-item ${rarity}`;
                    const imageStyle = item.brightness ? `style="filter: brightness(${item.brightness})"` : '';
                    itemDiv.innerHTML = `
                        <div class="case-details-item-image">
                            <img src="${getItemImagePath(item)}" alt="${item.name}" ${imageStyle}>
                        </div>
                        <div class="case-details-item-name">${item.name}</div>
                    `;
                    gridDiv.appendChild(itemDiv);
                });

                groupDiv.appendChild(gridDiv);
                itemsContainer.appendChild(groupDiv);
            });

            document.getElementById('caseDetailsOverlay').classList.add('active');
            document.getElementById('caseDetailsBuyBtn').onclick = () => {
                buyCase(caseId);
                document.getElementById('caseDetailsOverlay').classList.remove('active');
            };
        }

        function buyCase(caseId) {
            const caseData = availableCases.find(c => c.id === caseId);
            if (caseData) {
                userCases.push({
                    id: Date.now(),
                    name: caseData.name,
                    type: 'Case',
                    rarity: 'consumer-grade',
                    imageName: caseData.imageName,
                    caseTypeId: caseId
                });
                localStorage.setItem('userCases', JSON.stringify(userCases));
                renderInventory();
                if (currentSort !== 'newest') sortInventory(currentSort);
            }
        }

        document.getElementById('caseDetailsCloseBtn').addEventListener('click', () => {
            document.getElementById('caseDetailsOverlay').classList.remove('active');
        });
        document.getElementById('caseDetailsOverlay').addEventListener('click', function(e) {
            if (e.target === this) this.classList.remove('active');
        });

        document.querySelectorAll('.case-card').forEach(caseCard => {
            const caseId = caseCard.getAttribute('data-case-id');
            const marketBtn = caseCard.querySelector('.case-market-btn');
            marketBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                showCaseDetails(caseId);
            });
            caseCard.addEventListener('click', function(e) {
                if (e.target.closest('.case-market-btn')) return;
                buyCase(caseId);
            });
        });

        // Delete button
        const deleteBtn = document.getElementById('deleteModal');
        const confirmDialog = document.getElementById('confirmDialog');

        deleteBtn.addEventListener('click', () => confirmDialog.classList.add('active'));
        document.getElementById('confirmNo').addEventListener('click', () => confirmDialog.classList.remove('active'));
        document.getElementById('confirmYes').addEventListener('click', function() {
            if (currentModalItem && currentModalItem.id) {
                userCases = userCases.filter(c => c.id !== currentModalItem.id);
                localStorage.setItem('userCases', JSON.stringify(userCases));
                renderInventory();
                if (currentSort !== 'newest') sortInventory(currentSort);
                confirmDialog.classList.remove('active');
                closeInspectModal();
            }
        });

        // Tab switching
        const mainNavItems = document.querySelectorAll('.main-nav-item');
        const subNav = document.getElementById('subNav');
        mainNavItems.forEach(item => {
            item.addEventListener('click', function() {
                mainNavItems.forEach(i => i.classList.remove('active'));
                this.classList.add('active');
                const tabName = this.getAttribute('data-nav');
                document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
                const targetTab = document.getElementById(tabName + 'Tab');
                if (targetTab) targetTab.classList.add('active');
                subNav.classList.toggle('active', tabName === 'inventory');
            });
        });

        // ========================================
        // CASE LOOT POOL
        // ========================================
        const caseLootPools = {
            'snakebite': [
                // skinImageName = the skin-specific image. imageName = base weapon fallback.
                { name: 'UMP-45 | Oscillator', type: 'SMG', rarity: 'mil-spec', imageName: 'ump-45.webp', skinImageName: 'skin-ump45-oscillator.webp', weight: 11.42 },
                { name: 'Nova | Windblown', type: 'Shotgun', rarity: 'mil-spec', imageName: 'nova.webp', skinImageName: 'skin-nova-windblown.webp', weight: 11.42 },
                { name: 'M249 | O.S.I.P.R.', type: 'Machine Gun', rarity: 'mil-spec', imageName: 'm249.webp', skinImageName: 'skin-m249-osipr.webp', weight: 11.42 },
                { name: 'SG 553 | Heavy Metal', type: 'Rifle', rarity: 'mil-spec', imageName: 'sg-553.webp', skinImageName: 'skin-sg553-heavymetal.webp', weight: 11.42 },
                { name: 'CZ75-Auto | Circaetus', type: 'Pistol', rarity: 'mil-spec', imageName: 'cz75-auto.webp', skinImageName: 'skin-cz75-circaetus.webp', weight: 11.42 },
                { name: 'R8 Revolver | Junk Yard', type: 'Pistol', rarity: 'mil-spec', imageName: 'r8-revolver.webp', skinImageName: 'skin-r8-junkyard.webp', weight: 11.42 },
                { name: 'Glock-18 | Clear Polymer', type: 'Pistol', rarity: 'mil-spec', imageName: 'glock-18.webp', skinImageName: 'skin-glock18-clearpolymer.webp', weight: 11.40 },
                { name: 'Negev | dev_texture', type: 'Machine Gun', rarity: 'restricted', imageName: 'negev.webp', skinImageName: 'skin-negev-devtexture.webp', weight: 3.2 },
                { name: 'P250 | Cyber Shell', type: 'Pistol', rarity: 'restricted', imageName: 'p250.webp', skinImageName: 'skin-p250-cybershell.webp', weight: 3.2 },
                { name: 'MAC-10 | Button Masher', type: 'SMG', rarity: 'restricted', imageName: 'mac-10.webp', skinImageName: 'skin-mac10-buttonmasher.webp', weight: 3.2 },
                { name: 'Desert Eagle | Trigger Discipline', type: 'Pistol', rarity: 'restricted', imageName: 'desert-eagle.webp', skinImageName: 'skin-deagle-triggerdiscipline.webp', weight: 3.2 },
                { name: 'AK-47 | Slate', type: 'Rifle', rarity: 'restricted', imageName: 'ak-47.webp', skinImageName: 'skin-ak47-slate.webp', weight: 3.18 },
                { name: 'XM1014 | XOXO', type: 'Shotgun', rarity: 'classified', imageName: 'xm1014.webp', skinImageName: 'skin-xm1014-xoxo.webp', weight: 1.07 },
                { name: 'MP9 | Food Chain', type: 'SMG', rarity: 'classified', imageName: 'mp9.webp', skinImageName: 'skin-mp9-foodchain.webp', weight: 1.07 },
                { name: 'Galil AR | Chromatic Aberration', type: 'Rifle', rarity: 'classified', imageName: 'galil-ar.webp', skinImageName: 'skin-galilar-chromaticaberration.webp', weight: 1.06 },
                { name: 'M4A4 | In Living Color', type: 'Rifle', rarity: 'covert', imageName: 'm4a4.webp', skinImageName: 'skin-m4a4-inlivingcolor.webp', weight: 0.32 },
                { name: 'USP-S | The Traitor', type: 'Pistol', rarity: 'covert', imageName: 'usp-s.webp', skinImageName: 'skin-usps-thetraitor.webp', weight: 0.32 },
                // Knives (extraordinary)
                { name: 'â˜… Bayonet', type: 'Knife', rarity: 'extraordinary', imageName: 'knifet.webp', skinImageName: 'skin-bayonet.webp', brightness: 0.5, weight: 0.0054 },
                { name: 'â˜… Bowie Knife', type: 'Knife', rarity: 'extraordinary', imageName: 'knifet.webp', skinImageName: 'skin-bowieknife.webp', brightness: 0.5, weight: 0.0054 },
                { name: 'â˜… Butterfly Knife', type: 'Knife', rarity: 'extraordinary', imageName: 'knifet.webp', skinImageName: 'skin-butterflyknife.webp', brightness: 0.5, weight: 0.0054 },
                { name: 'â˜… Falchion Knife', type: 'Knife', rarity: 'extraordinary', imageName: 'knifet.webp', skinImageName: 'skin-falchionknife.webp', brightness: 0.5, weight: 0.0054 },
                { name: 'â˜… Flip Knife', type: 'Knife', rarity: 'extraordinary', imageName: 'knifet.webp', skinImageName: 'skin-flipknife.webp', brightness: 0.5, weight: 0.0054 },
                { name: 'â˜… Gut Knife', type: 'Knife', rarity: 'extraordinary', imageName: 'knifet.webp', skinImageName: 'skin-gutknife.webp', brightness: 0.5, weight: 0.0054 },
                { name: 'â˜… Huntsman Knife', type: 'Knife', rarity: 'extraordinary', imageName: 'knifet.webp', skinImageName: 'skin-huntsmanknife.webp', brightness: 0.5, weight: 0.0054 },
                { name: 'â˜… Karambit', type: 'Knife', rarity: 'extraordinary', imageName: 'knifet.webp', skinImageName: 'skin-karambit.webp', brightness: 0.5, weight: 0.0054 },
                { name: 'â˜… M9 Bayonet', type: 'Knife', rarity: 'extraordinary', imageName: 'knifet.webp', skinImageName: 'skin-m9bayonet.webp', brightness: 0.5, weight: 0.0054 },
                { name: 'â˜… Navaja Knife', type: 'Knife', rarity: 'extraordinary', imageName: 'knifet.webp', skinImageName: 'skin-navajaknife.webp', brightness: 0.5, weight: 0.0054 },
                { name: 'â˜… Nomad Knife', type: 'Knife', rarity: 'extraordinary', imageName: 'knifet.webp', skinImageName: 'skin-nomadknife.webp', brightness: 0.5, weight: 0.0054 },
                { name: 'â˜… Paracord Knife', type: 'Knife', rarity: 'extraordinary', imageName: 'knifet.webp', skinImageName: 'skin-paracordknife.webp', brightness: 0.5, weight: 0.0054 },
                { name: 'â˜… Shadow Daggers', type: 'Knife', rarity: 'extraordinary', imageName: 'knifet.webp', skinImageName: 'skin-shadowdaggers.webp', brightness: 0.5, weight: 0.0054 },
                { name: 'â˜… Skeleton Knife', type: 'Knife', rarity: 'extraordinary', imageName: 'knifet.webp', skinImageName: 'skin-skeletonknife.webp', brightness: 0.5, weight: 0.0054 },
                { name: 'â˜… Stiletto Knife', type: 'Knife', rarity: 'extraordinary', imageName: 'knifet.webp', skinImageName: 'skin-stilettoknife.webp', brightness: 0.5, weight: 0.0054 },
                { name: 'â˜… Survival Knife', type: 'Knife', rarity: 'extraordinary', imageName: 'knifet.webp', skinImageName: 'skin-survivalknife.webp', brightness: 0.5, weight: 0.0054 },
                { name: 'â˜… Talon Knife', type: 'Knife', rarity: 'extraordinary', imageName: 'knifet.webp', skinImageName: 'skin-talonknife.webp', brightness: 0.5, weight: 0.0054 },
                { name: 'â˜… Ursus Knife', type: 'Knife', rarity: 'extraordinary', imageName: 'knifet.webp', skinImageName: 'skin-ursusknife.webp', brightness: 0.5, weight: 0.0054 },
                // Gloves â€” Broken Fang pool (extraordinary)
                { name: 'â˜… Broken Fang Gloves | Unhinged', type: 'Gloves', rarity: 'extraordinary', imageName: 'glovest.webp', skinImageName: 'skin-brokenfanggloves-unhinged.webp', weight: 0.0108 },
                { name: 'â˜… Broken Fang Gloves | Jade', type: 'Gloves', rarity: 'extraordinary', imageName: 'glovest.webp', skinImageName: 'skin-brokenfanggloves-jade.webp', weight: 0.0108 },
                { name: 'â˜… Broken Fang Gloves | Yellow-Whip', type: 'Gloves', rarity: 'extraordinary', imageName: 'glovest.webp', skinImageName: 'skin-brokenfanggloves-yellowwhip.webp', weight: 0.0108 },
                { name: 'â˜… Broken Fang Gloves | Needle Point', type: 'Gloves', rarity: 'extraordinary', imageName: 'glovest.webp', skinImageName: 'skin-brokenfanggloves-needlepoint.webp', weight: 0.0108 },
                { name: 'â˜… Sport Gloves | Slingshot', type: 'Gloves', rarity: 'extraordinary', imageName: 'glovest.webp', skinImageName: 'skin-sportgloves-slingshot.webp', weight: 0.0108 },
                { name: 'â˜… Sport Gloves | Amphibious', type: 'Gloves', rarity: 'extraordinary', imageName: 'glovest.webp', skinImageName: 'skin-sportgloves-amphibious.webp', weight: 0.0108 },
                { name: 'â˜… Sport Gloves | Vice', type: 'Gloves', rarity: 'extraordinary', imageName: 'glovest.webp', skinImageName: 'skin-sportgloves-vice.webp', weight: 0.0108 },
                { name: 'â˜… Sport Gloves | Omega', type: 'Gloves', rarity: 'extraordinary', imageName: 'glovest.webp', skinImageName: 'skin-sportgloves-omega.webp', weight: 0.0108 },
                { name: 'â˜… Driver Gloves | Snow Leopard', type: 'Gloves', rarity: 'extraordinary', imageName: 'glovest.webp', skinImageName: 'skin-drivergloves-snowleopard.webp', weight: 0.0108 },
                { name: 'â˜… Driver Gloves | Rezan the Red', type: 'Gloves', rarity: 'extraordinary', imageName: 'glovest.webp', skinImageName: 'skin-drivergloves-rezanthered.webp', weight: 0.0108 },
                { name: 'â˜… Driver Gloves | Queen Jaguar', type: 'Gloves', rarity: 'extraordinary', imageName: 'glovest.webp', skinImageName: 'skin-drivergloves-queenjaguar.webp', weight: 0.0108 },
                { name: 'â˜… Driver Gloves | Overtake', type: 'Gloves', rarity: 'extraordinary', imageName: 'glovest.webp', skinImageName: 'skin-drivergloves-overtake.webp', weight: 0.0108 },
                // Gloves â€” Hydra/Case Hardened pool (extraordinary)
                { name: 'â˜… Hand Wraps | Slaughter', type: 'Gloves', rarity: 'extraordinary', imageName: 'glovesct.webp', skinImageName: 'skin-handwraps-slaughter.webp', weight: 0.0108 },
                { name: 'â˜… Hand Wraps | CAUTION!', type: 'Gloves', rarity: 'extraordinary', imageName: 'glovesct.webp', skinImageName: 'skin-handwraps-caution.webp', weight: 0.0108 },
                { name: 'â˜… Hand Wraps | Cobalt Skulls', type: 'Gloves', rarity: 'extraordinary', imageName: 'glovesct.webp', skinImageName: 'skin-handwraps-cobaltskulls.webp', weight: 0.0108 },
                { name: 'â˜… Hand Wraps | Arid', type: 'Gloves', rarity: 'extraordinary', imageName: 'glovesct.webp', skinImageName: 'skin-handwraps-arid.webp', weight: 0.0108 },
                { name: 'â˜… Specialist Gloves | Tiger Strike', type: 'Gloves', rarity: 'extraordinary', imageName: 'glovesct.webp', skinImageName: 'skin-specialistgloves-tigerstrike.webp', weight: 0.0108 },
                { name: 'â˜… Specialist Gloves | Crimson Web', type: 'Gloves', rarity: 'extraordinary', imageName: 'glovesct.webp', skinImageName: 'skin-specialistgloves-crimsonweb.webp', weight: 0.0108 },
                { name: 'â˜… Specialist Gloves | Field Agent', type: 'Gloves', rarity: 'extraordinary', imageName: 'glovesct.webp', skinImageName: 'skin-specialistgloves-fieldagent.webp', weight: 0.0108 },
                { name: 'â˜… Specialist Gloves | Fade', type: 'Gloves', rarity: 'extraordinary', imageName: 'glovesct.webp', skinImageName: 'skin-specialistgloves-fade.webp', weight: 0.0108 },
                { name: 'â˜… Moto Gloves | Blood Pressure', type: 'Gloves', rarity: 'extraordinary', imageName: 'glovesct.webp', skinImageName: 'skin-motogloves-bloodpressure.webp', weight: 0.0108 },
                { name: 'â˜… Moto Gloves | Smoke Out', type: 'Gloves', rarity: 'extraordinary', imageName: 'glovesct.webp', skinImageName: 'skin-motogloves-smokeout.webp', weight: 0.0108 },
                { name: 'â˜… Moto Gloves | 3rd Commando Company', type: 'Gloves', rarity: 'extraordinary', imageName: 'glovesct.webp', skinImageName: 'skin-motogloves-3rdcommandocompany.webp', weight: 0.0108 },
                { name: 'â˜… Moto Gloves | Spearmint', type: 'Gloves', rarity: 'extraordinary', imageName: 'glovesct.webp', skinImageName: 'skin-motogloves-spearmint.webp', weight: 0.0108 },
            ]
        };

        // ========================================
        // IMAGE PATH HELPER
        // Skin drops use images/skins/skinImageName
        // Default inventory uses images/weapons/imageName
        // Cases use images/imageName
        // ========================================
        function getItemImagePath(item) {
            if (item.type === 'Case') return `images/${item.imageName}`;
            if (item.skinImageName) return `images/weapons/skins/${item.skinImageName}`;
            return `images/weapons/${item.imageName}`;
        }

        // ========================================
        // WEIGHTED RANDOM SELECTION
        // ========================================
        function selectRandomItem(lootPool) {
            const totalWeight = lootPool.reduce((sum, item) => sum + item.weight, 0);
            let random = Math.random() * totalWeight;
            for (const item of lootPool) {
                random -= item.weight;
                if (random <= 0) return { ...item };
            }
            return { ...lootPool[0] };
        }

        // ========================================
        // CASE OPENING â€” PREDETERMINES WINNER FIRST,
        // THEN BUILDS STRIP SO THE SELECTOR LANDS ON IT
        // ========================================
        function openCase(caseItem) {
            const caseTypeId = caseItem.caseTypeId || caseItem.id || 'snakebite';
            const lootPool = caseLootPools[caseTypeId] || caseLootPools['snakebite'];

            // 1. PREDETERMINE THE WINNER before any visuals
            const winningItem = selectRandomItem(lootPool);

            // 2. Build the strip
            const ITEM_WIDTH = 198; // 190px wide + 8px gap
            const TOTAL_ITEMS = 60;

            // We'll place the winning item at index WIN_INDEX
            // and scroll so it's centered under the selector
            const WIN_INDEX = 45; // near the end for dramatic effect

            const items = [];
            for (let i = 0; i < TOTAL_ITEMS; i++) {
                if (i === WIN_INDEX) {
                    items.push({ ...winningItem });
                } else {
                    items.push(selectRandomItem(lootPool));
                }
            }

            const overlay = document.getElementById('caseOpeningOverlay');
            const rollItemsContainer = document.getElementById('rollItems');
            overlay.classList.add('active');
            rollItemsContainer.innerHTML = '';

            items.forEach((item) => {
                const itemEl = document.createElement('div');
                itemEl.className = `roll-item ${item.rarity}`;
                const imageStyle = item.brightness ? `style="filter: brightness(${item.brightness})"` : '';
                const imagePath = getItemImagePath(item);
                itemEl.innerHTML = `
                    <div class="roll-item-image">
                        <img src="${imagePath}" alt="${item.name}" ${imageStyle}>
                    </div>
                    <div class="roll-item-name">${item.name}</div>
                `;
                rollItemsContainer.appendChild(itemEl);
            });

            // 3. Calculate exact pixel offset so the winning item's CENTER
            //    aligns with the green selector line (viewport center)
            //    Strip starts at left=0, each item is ITEM_WIDTH wide.
            //    Item center = WIN_INDEX * ITEM_WIDTH + (190/2)
            //    We want that center to be at window.innerWidth/2
            //    So translateX = window.innerWidth/2 - (WIN_INDEX * ITEM_WIDTH + 95)
            //    Add a small random sub-item jitter so it doesn't always land perfectly centered
            const jitter = (Math.random() - 0.5) * 80; // Â±40px variation within the item
            const targetX = window.innerWidth / 2 - (WIN_INDEX * ITEM_WIDTH + 95) + jitter;

            // Reset position instantly
            rollItemsContainer.style.transition = 'none';
            rollItemsContainer.style.transform = `translateX(${window.innerWidth / 2 - 95}px)`; // start at center showing item 0

            // Force reflow then animate
            rollItemsContainer.getBoundingClientRect();

            let animationDone = false;

            const finishOpening = () => {
                if (animationDone) return;
                animationDone = true;
                overlay.classList.remove('active');
                showWinReveal(winningItem, caseItem);
            };

            setTimeout(() => {
                rollItemsContainer.style.transition = 'transform 6s cubic-bezier(0.15, 0.0, 0.1, 1.0)';
                rollItemsContainer.style.transform = `translateX(${targetX}px)`;
            }, 50);

            // Skip button
            const skipBtn = document.getElementById('skipOpeningBtn');
            // Reset animation so skip button fades in each time
            skipBtn.style.animation = 'none';
            skipBtn.style.opacity = '0';
            skipBtn.getBoundingClientRect();
            skipBtn.style.animation = 'fadeInDelay 0.3s ease 1.5s forwards';

            skipBtn.onclick = finishOpening;

            // Auto-finish after animation completes
            setTimeout(finishOpening, 6500);
        }

        // ========================================
        // WIN REVEAL â€” SHOWS CORRECT ITEM, SMART "OPEN ANOTHER" BUTTON
        // ========================================
        function showWinReveal(item, openedCase) {
            const winOverlay = document.getElementById('winRevealOverlay');
            const rarityText = (item.rarity || 'special').toUpperCase().replace(/-/g, ' ');

            if (item.rarity === 'extraordinary') {
                document.getElementById('winRarity').textContent = `â˜… ${rarityText} â˜…`;
                document.getElementById('winName').textContent = item.name;
            } else if (item.rarity === 'covert') {
                document.getElementById('winRarity').textContent = `â˜… ${rarityText} â˜…`;
                document.getElementById('winName').textContent = item.name;
            } else {
                document.getElementById('winRarity').textContent = rarityText;
                document.getElementById('winName').textContent = item.name;
            }

            let imageStyle = '';
            if (item.brightness) imageStyle += `filter: brightness(${item.brightness});`;
            if (item.imageScale) imageStyle += ` transform: scale(${item.imageScale});`;

            const imagePath = getItemImagePath(item);
            document.getElementById('winImage').innerHTML = `<img src="${imagePath}" alt="${item.name}" style="${imageStyle} max-width:90%; max-height:90%; object-fit:contain;">`;

            winOverlay.classList.add('active');

            // Save won item
            const wonItem = {
                id: Date.now(),
                name: item.name,
                type: item.type,
                rarity: item.rarity,
                imageName: item.imageName
            };
            if (item.brightness) wonItem.brightness = item.brightness;
            if (item.imageScale) wonItem.imageScale = item.imageScale;
            if (item.offsetX) wonItem.offsetX = item.offsetX;
            if (item.offsetY) wonItem.offsetY = item.offsetY;
            if (item.skinImageName) wonItem.skinImageName = item.skinImageName;

            let userWins = JSON.parse(localStorage.getItem('userWins')) || [];
            userWins.push(wonItem);
            localStorage.setItem('userWins', JSON.stringify(userWins));

            // Remove the opened case from userCases
            userCases = userCases.filter(c => c.id !== openedCase.id);
            localStorage.setItem('userCases', JSON.stringify(userCases));

            renderInventory();
            if (currentSort !== 'newest') sortInventory(currentSort);

            // Check if user has more cases of the same type AFTER removing the opened one
            const caseTypeId = openedCase.caseTypeId || 'snakebite';
            const remainingCases = userCases.filter(c => (c.caseTypeId || 'snakebite') === caseTypeId);
            const hasMoreCases = remainingCases.length > 0;

            const openAnotherBtn = document.getElementById('winOpenAnotherBtn');
            openAnotherBtn.style.display = hasMoreCases ? 'inline-block' : 'none';

            // Close button
            document.getElementById('winCloseBtn').onclick = () => {
                winOverlay.classList.remove('active');
                closeInspectModal();
            };

            // Open Another button â€” only visible if cases remain
            if (hasMoreCases) {
                openAnotherBtn.onclick = () => {
                    winOverlay.classList.remove('active');
                    openCase(remainingCases[0]);
                };
            }
        }

        // Unlock case button
        document.getElementById('unlockCaseBtn').addEventListener('click', function() {
            if (currentModalItem && currentModalItem.type === 'Case') {
                closeInspectModal();
                setTimeout(() => openCase(currentModalItem), 300);
            }
        });
    </script>
</body>
</html>
